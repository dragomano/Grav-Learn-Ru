---
title: Производительность и кэширование
taxonomy:
    category: docs
---

Одна из основных характеристик, которые делают Grav настолько привлекательным — это её скорость. Это всегда было ключевым моментом в конструкции Grav, и в первую очередь это связано с кэшированием, но включает несколько других компонентов.

## Производительность

1. **Кэширование PHP имеет решающее значение**. Вы должны запустить PHP **opcache** и **usercache**, чтобы получить максимальную производительность от Grav. В PHP 5.5 и 5.6 **Zend opcache** с **APCu user cache** работает немного быстрее.

2. **SSD-накопители** могут иметь большое значение. Большинство вещей можно кэшировать в пользовательском кэше PHP, но некоторые хранятся в виде файлов, поэтому SSD-диски могут сильно повлиять на производительность.

3. **Собственный хостинг** всегда будет быстрее, чем виртуальная машина. Виртуальные машины — отличный способ, с помощью которого хостинг-провайдеры могут предложить гибкие среды «облачного» типа. Они добавляют уровень обработки, который всегда влияет на производительность. Grav всё ещё может быть быстрым на виртуальной машине (намного быстрее, чем Wordpress, Joomla и т. д.), Но всё же для оптимальной производительности вы не можете превзойти вариант нативного хостинга.

4. **Чем быстрее память**, тем лучше. Поскольку Grav работает очень быстро и многие из его решений для кэширования сильно используют память, скорость памяти на вашем сервере может иметь большое влияние на производительность. Grav не использует большие объемы памяти по сравнению с некоторыми платформами, поэтому объем памяти не так важен и не влияет на производительность так сильно, как тип памяти и скорость.

5. **Общий хостинг** дешев и доступен, но совместное использование ресурсов всегда немного замедляет работу. Опять же, Grav может очень хорошо работать на общем сервере (лучше, чем другие CMS), но для максимальной скорости лучше всего использовать выделенный сервер.

6. **Многоядерные процессоры** лучше. Всегда помогут более быстрые и продвинутые процессоры, но не так сильно, как другие моменты.

7. **Парсер PECL Yaml**. Установка собственного PHP-парсера PECL Yaml может увеличить анализ YAML на целых 400%! На это стоит обратить внимание, если вы ищете дополнительную скорость.

!! Getgrav.org работает на одном выделенном сервере с четырехъядерными процессорами, 16 ГБ памяти и твердотельными накопителями 6 ГБ. Мы также запускаем PHP 5.6 с Zend opcache и пользовательским кэшем APCu. На веб-серверах работает несколько других веб-сайтов, но не так много, как в среде общего хостинга.

## Параметры кэширования

Кэширование - это неотъемлемая функция Grav, которая заложена с самого начала. Механизм кэширования, который использует Grav, является основной причиной того, что Grav работает так быстро. Тем не менее, необходимо учитывать некоторые факторы.

Grav использует хорошо зарекомендовавшую себя библиотеку [Doctrine Cache](https://www.doctrine-project.org/projects/doctrine-cache/en/latest/index.html). Это означает, что Grav поддерживает любой механизм кэширования, поддерживаемый Doctrine Cache:

* **Auto** _(по умолчанию)_ - Находит лучший вариант автоматически
* **File** - Хранит файлы кэша в папке `cache/`
* **APC** - [https://php.net/manual/en/book.apc.php](https://php.net/manual/en/book.apc.php)
* **Memcache** - [https://php.net/manual/en/book.memcache.php](https://php.net/manual/en/book.memcache.php)
* **Redis** - [https://redis.io](https://redis.io)
* **WinCache** - [https://www.iis.net/downloads/microsoft/wincache-extension](https://www.iis.net/downloads/microsoft/wincache-extension)

По умолчанию Grav предварительно настроен на использование параметра «auto». Сначала идет попытка обнаружения **APC**, затем **WinCache**, затем **XCache** и, наконец, **File**. Вы, конечно, можете явно настроить кэш в вашем файле `user/config/system.yaml`, что может немного ускорить работу.

## Типы кэширования

На самом деле в Grav существует **5 типов * кэширования:

1. Кэширование конфигурации YAML в PHP.
2. Кэширование Core Grav для объектов страницы.
3. Кэширование файлов шаблонов в Twig в виде классов PHP.
4. Кэширование изображений для медиаресурсов.
5. Кэширование ресурсов CSS и JQuery с конвейерной обработкой.

Кэширование конфигурации YAML не настраивается и всегда будет компилировать и кэшировать конфигурацию в папку `/cache`. Кэширование изображений также всегда включено и сохраняет обработанные изображения в папке `/images`.

### Кэширование ядра Grav

Кэширование ядра Grav имеет следующие параметры конфигурации, настроенные в вашем файле `user/config/system.yaml`:

[prism classes="language-yaml line-numbers"]
cache:
  enabled: true                        # Установите значение `true`, чтобы включить кэширование
  check:
    method: file                       # Метод проверки обновлений на страницах: file|folder|hash|none
  driver: auto                         # Один из: auto|file|apc|xcache|memcache|wincache
  prefix: 'g'                          # Строка префикса кэша (предотвращает конфликты)
[/prism]

Как видите, параметры задокументированы в самом файле конфигурации. Во время разработки иногда бывает полезно отключить кэширование, чтобы всегда иметь последние правки страниц.

По умолчанию Grav использует метод проверки файлов для кэширования. Это означает, что каждый раз, когда вы запрашиваете URL Grav, Grav использует оптимизированную маршрутизацию для прохождения всех **файлов** в папке `user/pages`, чтобы определить, изменилось ли что-нибудь.

Проверка кэша папок будет немного быстрее, чем проверка файлов, но не будет работать надежно во всех средах. Вам нужно будет проверить, улавливает ли Grav изменения страниц на вашем сервере при использовании опции `folder`.

Проверка хеширования использует алгоритм быстрого хеширования для всех файлов в каждой папке страницы. В некоторых ситуациях это может быть быстрее, чем проверка файлов, и в нем учитываются все файлы в папке.

Если автоматическое повторное кэширование измененных страниц не критично для вас (или если ваш сайт довольно большой), то установка этого значения на «none» ещё больше ускорит производственную среду. Вам просто нужно будет вручную [очистить кэш](../grav-cli#clearing-grav-cache) после внесения изменений.

#### Специальные параметры Memcache

Есть некоторые дополнительные параметры конфигурации, которые требуются, если вы подключаетесь к серверу **memcache** через параметр драйвера memcache. Эти параметры должны находиться в группе `cache:` в вашем `user/config/system.yaml`:

[prism classes="language-yaml line-numbers"]
cache:
  ...
  memcache:
    server: localhost
    port: 11211
[/prism]

#### Специальные параметры Memcached

Подобно memcache, memcached имеет некоторые дополнительные параметры конфигурации, которые требуются, если вы подключаетесь к серверу **memcached** через параметр драйвера memcached. Эти параметры должны находиться в группе `cache:` в вашем `user/config/system.yaml`:

[prism classes="language-yaml line-numbers"]
cache:
  ...
  memcached:
    server: localhost
    port: 11211
[/prism]


#### Специальные параметры Redis

Есть некоторые дополнительные параметры конфигурации, которые необходимы, если вы подключаетесь к серверу **redis** через параметр драйвера `redis`. Эти параметры должны находиться в группе `cache:` в вашем `user/config/system.yaml`:

[prism classes="language-yaml line-numbers"]
cache:
  ...
  redis:
    server: localhost
    port: 6379
[/prism]

В качестве альтернативы вы можете использовать соединение через сокет:

[prism classes="language-yaml line-numbers"]
cache:
  ...
  redis:
    socket: '/tmp/redis.sock'
[/prism]

Если ваш сервер Redis имеет пароль или секретный ключ, вы также можете установить его в этой конфигурации:

[prism classes="language-yaml line-numbers"]
cache:
  ...
  redis:
    password: your-secret
[/prism]

!!!! Удаление страницы не приводит к очистке кэша, поскольку очистка кэша основана на временных метках, измененных папкой.

<!-- -->

!!! Вы можете легко принудительно очистить кэш, просто пересохранив файл конфигурации.

Параметр `cache: check: pages:` может обеспечить некоторые небольшие улучшения производительности, но из-за этого Grav не будет проверять какие-либо изменения страницы. Это задано как параметр **Только для производства**.

Механизм создания шаблонов Twig использует свою собственную файловую систему кэширования, и с ней связано несколько параметров.

[prism classes="language-yaml line-numbers"]
twig:
  cache: false                          # Установите значение `true`, чтобы включить кэширование Twig
  debug: true                           # Включить отладку Twig
  auto_reload: true                     # Обновлять кэш при изменениях
  autoescape: false                     # Экранирование переменных Twig
[/prism]

Для небольшого увеличения производительности вы можете отключить расширение `debug`, а также отключить `auto_reload`, которое выполняет функцию, аналогичную `cache: check: pages`, так как оно не будет искать изменения в файлах` .html.twig` для запуска кэш обновляется.

## Кэширование и события

По большей части, [события всё ещё запускаются](/plugins/event-hooks) даже при включенном кэшировании. Это справедливо для всех событий, за исключением `onPageContentRaw`, `onPageProcessed`, `onPageContentProcessed`, `onTwigPageVariables` и `onFolderProcessed`. Эти события запускаются при рекурсии всех страниц и папок и запускаются на каждой найденной странице или папке. Как следует из их названия, они запускаются только во время обработки***, а не после кэширования страницы.
