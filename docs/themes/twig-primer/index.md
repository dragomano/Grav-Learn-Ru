---
description: Изучаем синтаксис Twig.
---

# Шаблонизатор Twig

Twig — быстрый оптимизированный шаблонный движок для PHP. Он разработан с нуля, чтобы облегчить создание шаблонов как разработчику, так и дизайнеру.

Легкий синтаксис и простые процессы делают его естественным для всех, кто знаком с Smarty, Django, Jinja, Liquid или Stencil.

Мы используем его для наших Grav-шаблонов отчасти из-за его гибкости и присущей безопасности. Тот факт, что это один из самых быстрых шаблонных движков для PHP, заставил выбрать его для использования в Grav без мозгов.

Twig компилирует шаблоны в простой PHP. Это сокращает количество накладных расходов на PHP до минимума, что приводит к более быстрой и оптимизированной работе разработчиков.

Twig является очень гибким движком благодаря своему *гибкому* и *парсельному*. Это позволяет разработчику создавать собственные пользовательские теги и фильтры. Лексер и синтаксический анализатор Twig также позволяет ему создать свой собственный [предметно-ориентированный язык](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%B5%D0%B4%D0%BC%D0%B5%D1%82%D0%BD%D0%BE-%D0%BE%D1%80%D0%B8%D0%B5%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9_%D1%8F%D0%B7%D1%8B%D0%BA) (DSL).

Когда дело доходит до охраны, Твиг не срезает углы. Это дает разработчику режим песочницы, который позволяет исследовать любой недоверенный код. Это дает вам возможность использовать Twig в качестве языка шаблонов для приложений, в то же время давая пользователям возможность изменять дизайн шаблонов.

По сути, это мощный движок, который дает вам контроль над пользовательским интерфейсом. В сочетании с YAML для конфигурирования, это делает мощную и простую систему для работы с любым разработчиком или менеджером сайтов.

## Как работает Twig?

Twig работает, убирая все фокус-покус из дизайна шаблона. Шаблоны - это, в основном, просто текстовые файлы, содержащие *переменные* или *выражения*, которые при оценке шаблона заменяются значениями.

*Теги* также являются важной частью файла шаблона, так как они контролируют логику самого шаблона.

Twig имеет два основных языковых ограничения:

* `{{ }}` выводит результат вычисления выражения;
* `{% %}` выполняет инструкции.

Вот базовый шаблон, созданный с помощью Twig:

```twig
<!DOCTYPE html>
<html>
    <head>
        <title>All About Cookies</title>
    </head>
    <body>
        My name is {{ name }} and I love cookies.
        My favorite flavors of cookies are:
        <ul>
        {% for cookie in cookies %}
            <li>{{ cookie.flavor }}</li>
        {% endfor %}
        </ul>
        <h1>Cookies are the best!</h1>
    </body>
</html>
```

В этом примере мы устанавливаем заголовок сайта так же, как и для любой стандартной веб-страницы. Разница в том, что мы смогли использовать простой синтаксис Twig для представления имени автора и создания динамического списка типов элементов.

Шаблон сначала загружается, а затем передается через **lexer**, где его исходный код маркируется и разбивается на мелкие кусочки. В этот момент **синтаксический анализатор** принимает токены и превращает их в абстрактное синтаксическое дерево.

Как только это делается, компилятор превращает это в PHP-код, который затем может быть оценен и отображен пользователю.

Twig также может быть расширен для добавления дополнительных тегов, фильтров, тестов, операторов, глобальных переменных и функций. Более подробную информацию о расширении Twig можно найти в его [официальной документации](https://twig.symfony.com/doc/3.x/advanced.html).

## Синтаксис Twig

Шаблон Twig имеет несколько ключевых компонентов, которые помогают ему понять, что именно вы хотели бы сделать. К ним относятся теги, фильтры, функции и переменные.

Давайте более подробно рассмотрим эти важные инструменты и то, как они могут вам помочь создать невероятный шаблон.

### Теги

Теги говорят Twig, что ему нужно делать. Он позволяет вам установить, какой код Twig должен обрабатывать, а какой код он должен игнорировать во время оценки.

Существует несколько различных типов тегов, и каждый из них имеет свой собственный специфический синтаксис, который отличает их друг от друга.

#### Комментарии

Теги комментариев (`{#Insert Comment Here#}') используются для установки комментариев, которые существуют в файле шаблона Twig, но фактически не видны конечному пользователю. Они удаляются во время парсинга, не анализируются и не выводятся.

Хорошо использовать эти теги для объяснения того, что делает конкретная строка кода или команда, чтобы другой разработчик или дизайнер в вашей команде мог быстро прочитать и понять.

Вот пример тега комментария, который вы найдете в файле шаблона Twig:

```twig
{# Chocolate Chip Cookies are great! Don't tell anyone! #}
```

#### Выходные теги

Выходные теги ('{{ Insert Output Here }}`) будут оценены и добавлены к сгенерированному выходу. Это место, где вы можете поместить все, что хотите, чтобы появиться на переднем конце, или в каком-то другом сгенерированном контенте.

Вот пример выходных тегов, используемых в шаблоне Twig:

```twig
My name is {{ name }} and I love cookies.
```

Переменная `name` была вставлена в эту строку и будет показана конечному пользователю как `My name is Jake and I love cookies.`, так как `Jake` было значение переменной имени.

!!! warning ""

    Очень важно включить параметр `autoescape` в [конфигурации системы](/basics/grav-configuration/#twig) или не забыть экранировать каждую переменную в файлах шаблонов с помощью фильтра `|e`, чтобы защитить сайт от XSS-атак. Для безопасного HTML-контента используйте фильтр `|raw`.

#### Теги действий

Теги действий — это путеводители в мире Twig. Эти теги на самом деле что-то делают, в отличие от других, которые либо передают что-то, либо сидят сложа руки в исходном коде, ожидая, пока дизайнер прочитает его.

Теги действий задают переменные, цикл через массивы и условия тестирования. Ваши `for` и `if` заявления сделаны с использованием этих меток.

Вот как может выглядеть тег действия в шаблоне Twig:

```twig
{% set hour = now | date("G") %}
{% if hour >= 9 and hour < 17 %}
    <p>Time for cookies!</p>
{% else %}
    <p>Time to bake more cookies!</p>
{% endif %}
```

Первоначальный тег действия устанавливает час как текущий час в 24-часовом формате. Это значение затем используется для определения, находится ли оно между 9 утра и 5 вечера. Если это так, то отображается `Время для печенюшек!`. Если это не так, то вместо этого отображается `Пришло время испечь ещё печенья!`.

Очень важно, чтобы метки не перекрывали друг друга. Вы не можете поместить выходной тег внутри тега действия или наоборот.

### Фильтры

Фильтры полезны, особенно когда вы используете выходные теги для отображения данных, которые могут быть отформатированы не так, как вы хотите.

Допустим, значение переменной `name` может включать нежелательные SGML/XML тэги. Вы можете отфильтровать их, используя код, приведенный ниже:

```twig
{{ name|striptags }}
```

### Функции

Функции могут генерировать контент. За ними, как правило, следуют аргументы, которые появляются в скобках, помещаемых непосредственно после вызова функции. Даже если аргумент отсутствует, функция все равно будет иметь скобки `()`, расположенные непосредственно после нее.

```twig
{% if date(cookie.created_at) < date('-2days') %}
    {# Eat it! #}
{% endif %}
```

## Ресурсы

* [Официальная документация Twig](https://twig.symfony.com/doc/1.x/)
* [Twig для дизайнеров шаблонов](https://twig.symfony.com/doc/1.x/templates.html)
* [Twig для разработчиков](https://twig.symfony.com/doc/1.x/api.html)
* [6-минутное введение в Twig](https://www.dev-metal.com/6min-video-introduction-twig-php-templating-engine/)
* [Введение в Twig](https://www.slideshare.net/markstory/introduction-to-twig)
* [Twig: Основы (бесплатное вступление к платному курсу)](https://knpuniversity.com/screencast/twig/basics)
